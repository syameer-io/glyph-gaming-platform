window.lobbyPage=function(i,c=[],l=[]){return{userId:i,games:c,friendIds:l,selectedGame:"",selectedGameName:"",selectedGameImg:"",selectedJoinMethod:"",selectedMethodData:null,availableJoinMethods:[],activeLobbies:[],formData:{steam_lobby_link:"",server_ip:"",server_port:"",server_password:"",lobby_code:"",join_command:"",match_name:"",match_password:"",manual_instructions:""},loading:!1,error:"",success:"",currentStep:1,copiedLobbyId:null,feedLobbies:[],feedLoading:!1,feedFilter:{game:"",source:"all"},copiedFeedLobbyId:null,echoChannels:[],methodDescriptions:{steam_lobby:"Share your Steam lobby link for instant join",steam_connect:"Connect via server IP using console command",server_address:"Direct server connection with IP address",lobby_code:"Share a party/lobby code for easy joining",join_command:"Use an in-game command to join",private_match:"Set up a private match with room name",manual_invite:"Provide custom instructions for joining"},init(){console.log("[LobbyPage] Initializing for user:",this.userId),console.log("[LobbyPage] Games available:",this.games.length),console.log("[LobbyPage] Friends for real-time:",this.friendIds.length),this.loadActiveLobbies(),this.loadFeed(),this.setupRealtimeListeners(),setInterval(()=>{this.$refs.lobbiesList&&this.$refs.lobbiesList.querySelectorAll("[data-expires]").forEach(t=>{const o=t.dataset.expires;o&&(t.textContent=this.formatTimeRemaining(o))})},1e3)},selectGame(e,t,o){console.log("[LobbyPage] Game selected:",e,t),this.selectedGame=e,this.selectedGameName=t,this.selectedGameImg=o,this.selectedJoinMethod="",this.selectedMethodData=null,this.resetFormData(),this.loadGameJoinMethods().then(()=>{this.currentStep=2})},selectJoinMethod(e){console.log("[LobbyPage] Join method selected:",e),this.selectedJoinMethod=e.join_method,this.selectedMethodData=e,this.resetFormData(),this.currentStep=3},goToStep(e){console.log("[LobbyPage] Going to step:",e),e===1?this.currentStep=1:e===2?this.selectedGame&&(this.currentStep=2):e===3&&this.selectedGame&&this.selectedJoinMethod&&(this.currentStep=3)},goBack(){this.currentStep>1&&(this.currentStep--,console.log("[LobbyPage] Going back to step:",this.currentStep))},getMethodIcon(e){const t={steam_lobby:`<svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                </svg>`,steam_connect:`<svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M20 13H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-6c0-.55-.45-1-1-1zM7 19c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM20 3H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM7 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                </svg>`,server_address:`<svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M19 15v4H5v-4h14m1-2H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-6c0-.55-.45-1-1-1zM7 18.5c-.82 0-1.5-.67-1.5-1.5s.68-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM19 5v4H5V5h14m1-2H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM7 8.5c-.82 0-1.5-.67-1.5-1.5S6.18 5.5 7 5.5s1.5.68 1.5 1.5S7.83 8.5 7 8.5z"/>
                </svg>`,lobby_code:`<svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                </svg>`,join_command:`<svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M20 19V7c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zM6 7h12v2H6V7zm0 4h12v2H6v-2zm0 4h8v2H6v-2z"/>
                </svg>`,private_match:`<svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/>
                </svg>`,manual_invite:`<svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
                    <path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>`};return t[e]||t.manual_invite},getMethodDescription(e){return this.methodDescriptions[e]||"Custom join method"},async loadActiveLobbies(){var e;try{const o=await(await fetch("/api/lobbies/my-lobbies",{headers:{Accept:"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},credentials:"same-origin"})).json();o.success&&(this.activeLobbies=o.lobbies||[],console.log("[LobbyPage] Loaded",this.activeLobbies.length,"active lobbies"))}catch(t){console.error("[LobbyPage] Failed to load lobbies:",t)}},async loadGameJoinMethods(){var e;if(!this.selectedGame){this.availableJoinMethods=[],this.selectedJoinMethod="";return}this.loading=!0,this.error="";try{console.log("[LobbyPage] Loading join methods for game:",this.selectedGame);const o=await(await fetch(`/api/games/${this.selectedGame}/join-methods`,{headers:{Accept:"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},credentials:"same-origin"})).json();o.success&&Array.isArray(o.join_methods)?(this.availableJoinMethods=o.join_methods,this.selectedJoinMethod="",this.selectedMethodData=null,console.log("[LobbyPage] Loaded",this.availableJoinMethods.length,"join methods")):(this.error="No join methods available for this game",this.availableJoinMethods=[])}catch(t){console.error("[LobbyPage] Failed to load join methods:",t),this.error="Failed to load join methods",this.availableJoinMethods=[]}finally{this.loading=!1}},async saveLobby(){var e;if(this.canSave()){this.loading=!0,this.error="",this.success="";try{const t={game_id:parseInt(this.selectedGame),join_method:this.selectedJoinMethod,...this.getRelevantFormData()};console.log("[LobbyPage] Creating lobby with payload:",t);const s=await(await fetch("/api/lobbies",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},credentials:"same-origin",body:JSON.stringify(t)})).json();s.success?(this.success="Lobby created successfully!",this.resetForm(),await this.loadActiveLobbies(),setTimeout(()=>this.success="",3e3)):this.error=s.message||"Failed to create lobby"}catch(t){console.error("[LobbyPage] Failed to create lobby:",t),this.error="Failed to create lobby. Please try again."}finally{this.loading=!1}}},async deleteLobby(e){var t;if(confirm("Are you sure you want to delete this lobby?")){this.loading=!0;try{const s=await(await fetch(`/api/lobbies/${e}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content)||""},credentials:"same-origin"})).json();s.success?(await this.loadActiveLobbies(),this.success="Lobby deleted successfully",setTimeout(()=>this.success="",3e3)):this.error=s.message||"Failed to delete lobby"}catch(o){console.error("[LobbyPage] Failed to delete lobby:",o),this.error="Failed to delete lobby"}finally{this.loading=!1}}},getRelevantFormData(){const e={};switch(this.selectedJoinMethod){case"steam_lobby":e.steam_lobby_link=this.formData.steam_lobby_link;break;case"steam_connect":case"server_address":e.server_ip=this.formData.server_ip,e.server_port=this.formData.server_port,this.formData.server_password&&(e.server_password=this.formData.server_password);break;case"lobby_code":e.lobby_code=this.formData.lobby_code;break;case"join_command":e.join_command=this.formData.join_command;break;case"private_match":e.match_name=this.formData.match_name,this.formData.match_password&&(e.match_password=this.formData.match_password);break;case"manual_invite":e.manual_instructions=this.formData.manual_instructions;break}return e},canSave(){if(!this.selectedGame||!this.selectedJoinMethod)return!1;switch(this.selectedJoinMethod){case"steam_lobby":return!!this.formData.steam_lobby_link;case"steam_connect":case"server_address":return!!this.formData.server_ip;case"lobby_code":return!!this.formData.lobby_code;case"join_command":return!!this.formData.join_command;case"private_match":return!!this.formData.match_name;case"manual_invite":return!!this.formData.manual_instructions;default:return!1}},resetForm(){this.selectedGame="",this.selectedGameName="",this.selectedGameImg="",this.selectedJoinMethod="",this.selectedMethodData=null,this.availableJoinMethods=[],this.resetFormData(),this.currentStep=1,this.error=""},resetFormData(){this.formData={steam_lobby_link:"",server_ip:"",server_port:"",server_password:"",lobby_code:"",join_command:"",match_name:"",match_password:"",manual_instructions:""}},formatJoinMethod(e){return{steam_lobby:"Steam Lobby",steam_connect:"Server IP",server_address:"Server Address",lobby_code:"Lobby Code",join_command:"Join Command",private_match:"Private Match",manual_invite:"Manual Invite"}[e]||e},getJoinInfo(e){switch(e.join_method){case"steam_lobby":return e.steam_lobby_id&&e.steam_app_id?`steam://joinlobby/${e.steam_app_id}/${e.steam_lobby_id}/${e.steam_profile_id||""}`:e.steam_lobby_link||"Steam Lobby";case"steam_connect":return e.server_ip+(e.server_port?":"+e.server_port:"");case"server_address":return e.server_ip+(e.server_port?":"+e.server_port:"");case"lobby_code":return e.lobby_code||"Code";case"join_command":return e.join_command||"Command";case"private_match":return e.match_name||"Private Match";case"manual_invite":return e.manual_instructions||"Manual Invite";default:return"Join"}},getTimeRemainingMinutes(e){if(!e)return null;const t=new Date,s=new Date(e)-t;return Math.floor(s/6e4)},formatTimeRemaining(e){if(!e)return"No expiration";const t=new Date,s=new Date(e)-t;if(s<=0)return"Expired";const a=Math.floor(s/6e4),n=Math.floor(s%6e4/1e3),r=Math.floor(a/60);return r>0?`${r}h ${a%60}m remaining`:a>0?`${a}m ${n}s remaining`:`${n}s remaining`},async copyToClipboard(e,t){try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(e);else{const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)}this.copiedLobbyId=t,setTimeout(()=>this.copiedLobbyId=null,2e3)}catch(o){console.error("[LobbyPage] Failed to copy:",o)}},async loadFeed(){var e;this.feedLoading=!0;try{const t=new URLSearchParams;this.feedFilter.game&&t.append("game_id",this.feedFilter.game),this.feedFilter.source&&t.append("source",this.feedFilter.source);const o=`/api/lobbies/feed${t.toString()?"?"+t.toString():""}`;console.log("[LobbyPage] Loading feed:",o);const a=await(await fetch(o,{headers:{Accept:"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},credentials:"same-origin"})).json();a.success?(this.feedLobbies=a.lobbies||[],console.log("[LobbyPage] Loaded",this.feedLobbies.length,"feed lobbies")):(console.error("[LobbyPage] Feed load failed:",a.message),this.feedLobbies=[])}catch(t){console.error("[LobbyPage] Failed to load feed:",t),this.feedLobbies=[]}finally{this.feedLoading=!1}},setupRealtimeListeners(){if(typeof window.Echo>"u"){console.warn("[LobbyPage] Echo not available, real-time updates disabled");return}console.log("[LobbyPage] Setting up real-time listeners for",this.friendIds.length,"friends"),this.friendIds.forEach(e=>{const t=`user.${e}.lobby`;try{const o=window.Echo.private(t).listen(".lobby.created",s=>{console.log("[LobbyPage] Friend created lobby:",s),this.handleLobbyCreated(s)}).listen(".lobby.deleted",s=>{console.log("[LobbyPage] Friend deleted lobby:",s),this.handleLobbyDeleted(s)}).listen(".lobby.expired",s=>{console.log("[LobbyPage] Friend lobby expired:",s),this.handleLobbyDeleted(s)});this.echoChannels.push({name:t,channel:o})}catch(o){console.warn("[LobbyPage] Failed to subscribe to channel:",t,o)}})},handleLobbyCreated(e){this.loadFeed()},handleLobbyDeleted(e){const t=e.lobby_id||e.lobbyId;t&&(this.feedLobbies=this.feedLobbies.filter(o=>o.id!==t),console.log("[LobbyPage] Removed lobby from feed:",t))},canDirectJoin(e){return e.join_link?e.join_link.startsWith("steam://"):!1},async copyFeedJoinInfo(e){const t=e.join_info||e.join_link||"";if(!t){console.warn("[LobbyPage] No join info to copy");return}try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t);else{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)}this.copiedFeedLobbyId=e.id,setTimeout(()=>this.copiedFeedLobbyId=null,2e3),console.log("[LobbyPage] Copied join info:",t)}catch(o){console.error("[LobbyPage] Failed to copy feed join info:",o)}},destroy(){console.log("[LobbyPage] Cleaning up",this.echoChannels.length,"Echo channels"),this.echoChannels.forEach(({name:e})=>{try{window.Echo.leave(e)}catch(t){console.warn("[LobbyPage] Failed to leave channel:",e,t)}}),this.echoChannels=[]}}};if(!document.getElementById("lobby-page-animations")){const i=document.createElement("style");i.id="lobby-page-animations",i.textContent=`
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `,document.head.appendChild(i)}
